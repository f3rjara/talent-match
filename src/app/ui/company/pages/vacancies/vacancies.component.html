<div class="vacancies py-8">
  <!-- Toast para notificaciones -->
  <p-toast>
    <ng-template let-message pTemplate="message">
      <div class="toast-content">
        <i [class]="'pi ' + (message.icon || 'pi-info-circle')"></i>
        <div class="toast-text">
          <div class="toast-summary">{{ message.summary }}</div>
          <div class="toast-detail">{{ message.detail }}</div>
        </div>
        <button
          *ngIf="message.key === 'deleteToast'"
          pButton
          type="button"
          label="Deshacer"
          class="p-button-sm p-button-warning"
          (click)="undoDelete()"></button>
      </div>
    </ng-template>
  </p-toast>

  <!-- Dialog de confirmación -->
  <p-confirmDialog></p-confirmDialog>

  <div class="vacancies-header">
    <div class="title-section">
      <h1 class="main-title">Mis Ofertas Laborales</h1>
      <p class="subtitle">Gestiona y publica tus vacantes disponibles</p>
      <div class="counter-badge">
        <i class="pi pi-briefcase"></i>
        <span class="counter-text">
          <strong>{{ filteredVacanciesCount }}</strong> de <strong>{{ totalVacancies }}</strong> vacantes
        </span>
      </div>
    </div>
    <div class="action-section">
      <button
        pButton
        type="button"
        label="Nueva Vacante"
        icon="pi pi-plus"
        class="p-button-lg add-vacancy-btn"
        (click)="openModal()"></button>
    </div>
  </div>

  <div class="filters grid gap-4">
    <div class="filter-item col lg:col-2">
      <label for="experienciaFilter">Experiencia:</label>
      <p-dropdown
        id="experienciaFilter"
        [options]="experienciaOptions"
        [(ngModel)]="filters.experiencia"
        placeholder="Todas"
        (onChange)="applyFilters()">
      </p-dropdown>
    </div>
    <div class="filter-item col lg:col-2">
      <label for="ubicacionFilter">Ubicación:</label>
      <p-dropdown
        id="ubicacionFilter"
        [options]="ubicacionOptions"
        [(ngModel)]="filters.ubicacion"
        placeholder="Todas"
        (onChange)="applyFilters()">
      </p-dropdown>
    </div>
    <div class="filter-item col lg:col-2">
      <label for="disponibilidadFilter">Disponibilidad:</label>
      <p-dropdown
        id="disponibilidadFilter"
        [options]="disponibilidadOptions"
        [(ngModel)]="filters.disponibilidad"
        placeholder="Todas"
        (onChange)="applyFilters()">
      </p-dropdown>
    </div>
  </div>

  <!-- <div class="vacancy-cards">
    <p-card
      *ngFor="let vacancy of filteredVacancies"
      header="{{ vacancy.titulo }}"
      class="vacancy-card"
    >
      <p><strong>Experiencia:</strong> {{ vacancy.experiencia }}</p>
      <p><strong>Ubicación:</strong> {{ vacancy.ubicacion }}</p>
      <p><strong>Disponibilidad:</strong> {{ vacancy.disponibilidad }}</p>
      <button pButton type="button" label="Apply" class="p-button-success"></button>
    </p-card>
  </div> -->

  <div class="vacancy-cards grid mt-8">
    <div *ngFor="let vacancy of filteredVacancies" class="vacancy-card col-12">
      <div class="card-header-section">
        <h3>{{ vacancy.title || vacancy.titulo }}</h3>
        <span class="status-badge" [ngClass]="'status-' + (vacancy.status || 'draft')">
          {{ vacancy.status === 'draft' ? 'Borrador' : vacancy.status === 'published' ? 'Publicada' : 'Cerrada' }}
        </span>
      </div>
      <p><strong>Experiencia:</strong> {{ vacancy.experienceRequired || vacancy.experiencia }}</p>
      <p><strong>Ubicación:</strong> {{ vacancy.location || vacancy.ubicacion }}</p>
      <p><strong>Disponibilidad:</strong> {{ vacancy.availability || vacancy.disponibilidad }}</p>
      <div class="vacancy-actions">
        <button
          pButton
          type="button"
          label="Ver Detalle"
          icon="pi pi-eye"
          class="p-button-sm p-button-outlined"
          (click)="viewVacancyDetail(vacancy)"></button>
        <button
          pButton
          type="button"
          label="Editar"
          icon="pi pi-pencil"
          class="p-button-sm p-button-outlined p-button-warning"
          (click)="editVacancy(vacancy)"></button>
        <button
          pButton
          type="button"
          label="Eliminar"
          icon="pi pi-trash"
          class="p-button-sm p-button-outlined p-button-danger"
          (click)="deleteVacancy(vacancy)"></button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <p-dialog
    header="Creación Rápida de Vacante"
    [(visible)]="modalVisible"
    (onHide)="closeModal()"
    [closable]="true"
    [style]="{ width: '50vw' }">
    <div class="modal-content">
      <div class="instructions-container mb-4">
        <div class="p-3 mb-3 surface-ground border-round">
          <p class="mt-0 mb-2 font-bold text-primary">¿Qué información puedo incluir?</p>
          <p class="mb-3">
            Esta herramienta captura la información esencial para publicar rápidamente. Menciona los siguientes datos:
          </p>

          <ul class="format-list mb-3 pl-3">
            <li class="mb-1"><strong>Título del cargo</strong> (Menciónalo al inicio)</li>
            <li class="mb-1"><strong>Experiencia</strong> (Palabra clave: "experiencia")</li>
            <li class="mb-1"><strong>Ubicación</strong> (Palabra clave: "ubicación")</li>
            <li class="mb-1"><strong>Disponibilidad</strong> (Palabra clave: "disponibilidad")</li>
          </ul>
        </div>

        <div class="example-box p-3 border-1 surface-border border-round mb-3">
          <p class="text-sm text-500 m-0 mb-1">Ejemplo de voz o texto:</p>
          <p class="font-italic m-0 text-900">
            "Analista de Calidad <strong>experiencia</strong> 2 años <strong>ubicación</strong> Medellín
            <strong>disponibilidad</strong> tiempo completo"
          </p>
        </div>

        <div class="info-note flex align-items-center p-2 text-sm text-600 bg-yellow-50 border-round">
          <i class="pi pi-info-circle mr-2 text-yellow-600"></i>
          <span>
            <strong>Nota:</strong> Detalles como <em>habilidades técnicas</em>, <em>competencias</em> y
            <em>descripción detallada</em> podrás agregarlos editando la vacante una vez creada.
          </span>
        </div>
      </div>

      <button
        pButton
        type="button"
        label="Iniciar grabación"
        (click)="startRecording()"
        class="p-button-success"
        [disabled]="isRecording"></button>

      <button
        pButton
        type="button"
        label="Detener grabación"
        (click)="stopRecording()"
        class="p-button-danger"
        *ngIf="isRecording"></button>

      <p *ngIf="transcription"><strong>Transcripción: </strong>"{{ transcription }}"</p>

      <button
        pButton
        type="button"
        label="Guardar vacante"
        (click)="saveVacancy()"
        class="p-button-primary"
        [disabled]="!transcription"></button>
    </div>
  </p-dialog>

  <!-- Formulario de Edición -->
  <app-vacancy-form
    [vacancy]="editingVacancy"
    [isVisible]="showEditModal"
    (onSave)="handleSaveVacancy($event)"
    (onCancel)="closeEditModal()">
  </app-vacancy-form>

  <!-- Diálogo de Detalles -->
  <app-vacancy-detail-dialog [vacancy]="selectedVacancy" [isVisible]="showDetailDialog" (onClose)="closeDetailDialog()">
  </app-vacancy-detail-dialog>
</div>
